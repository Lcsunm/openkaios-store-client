let article_array,dataSet,page=0,pos_focus=0,tabindex_i=-0,window_status="article-list",panels=["All"],current_panel=0,server_list=["https://banana-hackers.gitlab.io/store-db/data.json"," https://farooqkz.github.io/data.json"];$(document).ready(function(){function t(i){let s=new XMLHttpRequest;s.open("GET",i),s.timeout=4e3,s.responseType="json",s.send(),s.ontimeout=function(a){toaster("timeout please wait I try another source"),t(server_list[1])},s.onload=function(){200!=s.status&&toaster(`Error ${s.status}: ${s.statusText}`),403==s.status&&(toaster("database not found try another"),t(server_list[1])),200==s.status&&(dataSet=s.response,a(),e(),$("div#message-box").css("display","none"))},s.onprogress=function(t){t.lengthComputable},s.onerror=function(){toaster("Request failed, please try later.")}}function a(){let t=0;dataSet.apps.forEach(function(a,e){let i=dataSet.apps[e],s=i.name,n=i.description,o=i.download.url,d=i.git_repo,c=i.meta.categories,l=c.toString().replace(","," "),r=i.author.toString(),p=i.icon,u=i.license,b=i.type;-1===v.indexOf(r)&&v.push(r),t++;let f="elem-"+t;$("div#options").append("<div class='flex justify-content-spacearound' id='"+f+"'></div>"),d&&$("div#options div#"+f).append("<div tabindex='0' data-url='"+d+"'>open app source</div>"),$("div#options div#"+f).append("<div tabindex='1'>donation</div>");let w="<div class='meta-data'><div><span>Author </span>"+r+"</div><div><span>License </span>"+u+"</div><div><span>Type </span>"+b+"</div></div>",h="data-download ='"+o+"' data-url ='"+d+"'",y=$("<article id= '"+f+"' class= 'All "+l+" ' "+h+"><div class='icon'><img src='"+p+"'></div><div class='channel'>"+l+"</div><h1>"+s+"</h1><div class='summary'>"+n+"</div>"+w+"</article>");$("div#app-panels").append(y)}),i();let a=moment(dataSet.generated_at).format("DD.MM.YYYY, HH:mm"),e="<div>An alternative app store by free developers for free devices.The database of apps is hosted https://banana-hackers.gitlab.io/store-db , further can be added by a pull request.</div><div id='contributors'><h1>Contributors</h1>"+v.toString()+"</div><div class='footer'> Last update: "+a+"</div>",s=$("<article class='About'>"+e+"</article>");$("div#app-panels").append(s)}function e(){$.each(dataSet.categories,function(t,a){panels.push(t)}),panels.push("About"),$("div#navigation").append("<div>"+panels[0]+"</div>")}function i(){$("div#app-panels article").removeAttr("tabindex"),$("div#app-panels article").filter(":visible").each(function(t){$(this).prop("tabindex",t)}),article_array=$("div#app-panels article").filter(":visible"),s(),$("body").find("article[tabindex = 0]").focus()}function s(){let t=$("div#app-panels");t.find("article tabindex").sort(function(t,a){return a-t}).appendTo(t)}function n(t){$("article").css("display","none"),$("article."+t).css("display","block"),$("div#app-panels article").find([tabindex="0"]).focus()}function o(t){"left"==t&&current_panel--,"right"==t&&current_panel++,current_panel%=panels.length,current_panel<0&&(current_panel+=panels.length),$("div#navigation div").text(panels[current_panel]),n(panels[current_panel]),i(),pos_focus=0}function d(t){let a=document.activeElement.tabIndex,e=document.activeElement.parentNode.children.length-1,i=document.activeElement.parentNode.children;"+1"==t&&a<e&&(a++,i[a].focus()),"-1"==t&&a>0&&(a--,i[a].focus())}function c(){let t=$(":focus");$("article").css("display","none"),$("div#navigation").css("display","none"),$("div#app div#app-panels").css("margin","5px 0 0 0"),t.css("display","block"),$("div.summary").css("display","block"),$("div.meta-data").css("display","block"),$("div.icon").css("display","block"),$("div.channel").css("display","none"),$("div#button-bar").css("display","block"),$("div#button-bar div#button-left").css("color","white"),$("div#button-bar div#button-center").css("color","black"),$("div#button-bar div#button-right").css("color","white"),window_status="single-article"}function l(){navigator.spatialNavigationEnabled=!1,n(panels[current_panel]),$("div#app div#app-panels").css("margin","32px 0 0 0"),$("div#options").css("display","none");$(":focus");$("div#navigation").css("display","block"),$("div#app-panels").css("display","block"),$("div.summary").css("display","none"),$("div.meta-data").css("display","none"),$("div.channel").css("display","block"),$("div.icon").css("display","none");let t=article_array[pos_focus];t.focus(),$("div#button-bar").css("display","block"),$("div#button-bar div#button-left").css("color","black"),$("div#button-bar div#button-center").css("color","white"),$("div#button-bar div#button-right").css("color","black"),window.scrollTo(0,$(t).offset().top),window_status="article-list"}function r(){let t=article_array[pos_focus],a=$(t).data("download");window.location.assign(a)}function p(){let t=$(":focus");alert(t.attr("id"));let a=t.attr("id");$("div#options div").css("display","none"),$("div#options").css("display","block"),$("div#options div#"+a).css("display","block"),$("div#options div#"+a+" div").css("display","block"),$("div#button-bar div#button-left").css("color","black"),$("div#button-bar div#button-center").css("color","white"),$("div#button-bar div#button-right").css("color","black"),$("div#options div#"+a+" div:first").focus(),window_status="options"}function u(t){switch(t.key){case"Enter":"article-list"==window_status&&c(),"options"==window_status&&alert($(":focus").data("url"));break;case"ArrowDown":d("+1");break;case"ArrowUp":d("-1");break;case"ArrowLeft":"article-list"==window_status&&o("left");break;case"ArrowRight":"article-list"==window_status&&o("right");break;case"SoftLeft":case"1":"single-article"==window_status&&p();break;case"SoftRight":"single-article"==window_status&&r();break;case"Backspace":if(t.preventDefault(),"single-article"==window_status||"options"==window_status)return void l();"article-list"==window_status&&window.close()}}check_iconnection(),t(server_list[0]);let v=["40min"];document.addEventListener("keydown",u)});